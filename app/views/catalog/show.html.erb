<% @page_title = "#{application_name}" %>
<% extra_head_content << render_link_rel_alternates %>
<% sidebar_items << render_document_sidebar_partial %>

<%= render 'previous_next_doc' %>

<%# this should be in a partial -%>
<div id="document" class="<%= render_document_class %>">
  <div id="doc_<%= @document.id.to_s.parameterize %>">
    <div class="docHeader">
      <h2 class="docTitle"><%= @document[:title_s].first.to_s %></h2>
      <hr />
      <div class="tools">
          <%= render :partial => 'show_tools', :locals => {:document => @document} %>
          <%#= render :partial => 'cite_path', :locals => {:document => @document} %>
      </div>
      <% if current_user && @document[:video_s].nil? &&  %>
        <% cart_items = ShoppingCart.user_open_cart(current_user).last.shopping_cart_items.map{|item| item.solr_document_id} %>
        <% if cart_items.include? @document.id %>
        <span class="in_cart">Already in your cart</span>
        <% else %>
          <% cart = current_user.shopping_carts.user_open_cart(current_user).last %>
          <button class="add_to_cart" data-itemid="<%= @document[:id] %>" data-cartid="<%= cart.id unless cart.nil?  %>" data-userid="<%= current_user.id %>" data-title="<%= @document[:title_s].first.to_s %>">Add to cart</button>
        <% end %>
      <% else %>
        <button class="add_to_cart_no_user" >Add to cart</button>
        <div id="dialog" title="User Access Error">
          <p>You must be signed in to add items to your cart.<br /><br /><a href="/users/sign_in">Sign in here</a> or <a href="/users/sign_up">Sign up here</a></p>
        </div>
      <% end %>
    </div>

    <% # bookmark/folder functions -%>
    <%#= render_show_doc_actions @document %>        

         <%# record is visited; information is saved -%> 
          <% title = @document[:title_s].to_s %>
          <% doc_id = @document.id %>
          <% save_visit(title, doc_id) %>

    <div class="document">
      <%= render_document_partial @document, :show %>
    </div>
  </div>
</div>

  <% if @document.respond_to?(:export_as_openurl_ctx_kev) %>
    <!-- 
         // COinS, for Zotero among others. 
         // This document_partial_name(@document) business is not quite right,
         // but has been there for a while. 
    -->
    <span class="Z3988" title="<%= @document.export_as_openurl_ctx_kev(document_partial_name(@document)) %>"></span>
  <% end %>
