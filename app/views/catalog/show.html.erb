<% @page_title = "#{@document[:title_s].first.to_s} - #{application_name}" %>
<% extra_head_content << render_link_rel_alternates %>
<% sidebar_items << render(:partial => 'catalog/show_sidebar', :locals => {:document => @document}) %>

<%#= render 'previous_next_doc' %>

<%# this should be in a partial -%>
<div id="document" class="<%= render_document_class %>">
  <div id="doc_<%= @document.id.to_s.parameterize %>">
    <div class="header">
      <div class="title">
        <h1><%= @document[:title_s].first.to_s %></h1>
      </div>
      
      <div class="tools">
          <%= render :partial => 'show_tools', :locals => {:document => @document} %>
          <%#= render :partial => 'show_cart_tools', :locals => {:document => @document} %>
      </div>
    </div>

    <% # bookmark/folder functions -%>
    <%#= render_show_doc_actions @document %>     

         <%# record is visited; information is saved -%> 
          <% title = @document[:title_s].to_s %>
          <% doc_id = @document.id %>

    <div class="document">
      <p class="artifact_status">
        <%#= artifact_digitization_link(@document, @artifact) %>
        <%= artifact_digitization_link(@document, @artifact) %>
      </p>
      <%= render_document_partial @document, :show %>
    </div>
  </div>
</div>

<a name='comments'></a>

<% if @document.comments.present? %>
  <h3><%= pluralize(@document.comments.approved.count, 'Comment') %></h3>
  <p>(<%= pluralize(@document.comments.pending.count, 'Comment') %> waiting approval)</p>
<% else %>
  <h3>Comments</h3>
<% end %>

<% @document.comments.approved.each do |comment| %>
  <div class='comment'>
    <p class='metadata'>
      <span class='user'><%= comment.user.full_name %></span>
      <span class='date'><%= comment.created_at.strftime('%m/%d/%Y ') %></span>
    </p>
    <p class='body'><%= comment.comment %></p>
  </div>
<% end %>

<% @comment = Comment.new(params[:comment]) %>
<%= form_for(@comment) do |f| %>
  <%= f.hidden_field :solr_document_id, value: @document.id %>
  <h4>Post a new comment</h4>
  <%= f.text_area :comment %>
  <br />
  <%= f.submit "Comment" %>
<% end %>

  <% if @document.respond_to?(:export_as_openurl_ctx_kev) %>
    <!-- 
         // COinS, for Zotero among others. 
         // This document_partial_name(@document) business is not quite right,
         // but has been there for a while. 
    -->
    <span class="Z3988" title="<%= @document.export_as_openurl_ctx_kev(document_partial_name(@document)) %>"></span>
  <% end %>
